<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NepHR App</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#508C7F">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #508C7F; font-family: sans-serif; }
        #gatekeeper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #508C7F; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 9999; color: white; text-align: center;
        }
        .unlock-card {
            background: rgba(255, 255, 255, 0.1); padding: 40px 30px;
            border-radius: 25px; border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px); width: 80%; max-width: 320px;
        }
        .fingerprint-icon { font-size: 70px; margin-bottom: 20px; cursor: pointer; color: #fff; }
        h2 { margin: 10px 0; font-size: 22px; }
        p { opacity: 0.8; font-size: 14px; }
        #appFrame { width: 100%; height: 100%; border: none; display: none; }
        .logo-box { background: white; padding: 15px; border-radius: 15px; margin-bottom: 30px; }
        .logo-box img { height: 35px; }
    </style>
</head>
<body>

    <div id="gatekeeper">
        <div class="logo-box">
             <!-- यहाँ आफ्नो लोगोको लिङ्क राख्नुहोला -->
            <img src="https://wdertqstelnxutxhkgnp.supabase.co/storage/v1/object/public/branding/nephr-logo.png" alt="NepHR">
        </div>
        <div class="unlock-card" id="trigger-btn">
            <i class="fas fa-fingerprint fingerprint-icon"></i>
            <h2 id="msg-title">Tap to Unlock</h2>
            <p id="msg-body">Use Biometrics to access NepHR</p>
        </div>
    </div>

    <!-- तपाईंको Google Script URL यहाँ हाल्नुहोस् -->
    <iframe id="appFrame" src="https://script.google.com/macros/s/AKfycbxuviY7LYQyFN4fJZ4_mAaYzf1pTyQ7qkFrbcSOZPt6WHJd9tX-eY2w87NOwOqMu42f/exec" allow="geolocation"></iframe>

    <script>
        const frame = document.getElementById('appFrame');
        const gatekeeper = document.getElementById('gatekeeper');
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || (navigator.maxTouchPoints > 2);

        window.onload = function() {
            if (!isMobile) {
                loadSystem(); // ल्यापटपमा सिधै खोल्ने
            } else {
                // मोबाइलमा ट्याप गर्दा बायोमेट्रिक माग्ने
                document.getElementById('trigger-btn').onclick = requestUnlock;
                // सुरुमै एक पटक आफै माग्ने कोसिस गर्ने
                setTimeout(requestUnlock, 500);
            }
        };

        async function requestUnlock() {
            if (window.PublicKeyCredential) {
                try {
                    const challenge = crypto.getRandomValues(new Uint8Array(32));
                    const options = {
                        publicKey: {
                            challenge,
                            rp: { name: "NepHR" },
                            user: { id: challenge, name: "user", displayName: "User" },
                            pubKeyCredParams: [{ alg: -7, type: "public-key" }],
                            authenticatorSelection: { userVerification: "required" },
                            timeout: 60000
                        }
                    };
                    await navigator.credentials.create(options);
                    loadSystem();
                } catch (err) {
                    console.error(err);
                    document.getElementById('msg-title').innerText = "Try Again";
                }
            } else {
                loadSystem(); // बायोमेट्रिक नभएमा सिधै खोल्ने
            }
        }

        function loadSystem() {
            gatekeeper.style.display = 'none';
            frame.style.display = 'block';
        }
    </script>
</body>
</html>
